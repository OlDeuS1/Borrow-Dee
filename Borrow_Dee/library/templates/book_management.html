{% extends 'layouts/admin_base.html' %}
{% block title %}Book Management{% endblock %}
{% block sidebar %}
    {% with active_section='books' %}
        {% include 'layouts/admin_sidebar.html' %}
    {% endwith %}
{% endblock %}
{% block header %}
<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-10">
    <h1 class="text-4xl font-bold text-white">Book Management</h1>
    <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
        <div class="relative flex-1 min-w-[260px]">
            <input type="text" placeholder="Search books..." class="search-input pr-12" />
            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
        </div>
        <button id="addBookBtn" class="view-more-btn px-8 py-3 text-white font-medium flex items-center justify-center gap-2">
            <span class="text-lg leading-none">Ôºã</span> Add Book
        </button>
    </div>
</div>
{% endblock %}
{% block content %}
<div class="dashboard-card p-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6 divider pb-4">
        <h2 class="text-2xl font-semibold text-white">Books List</h2>
        <div class="flex gap-2 text-sm text-gray-400">
            <span><strong class="text-white">2</strong> total</span>
            <span class="hidden sm:inline">‚Ä¢</span>
            <span><strong class="text-[#4CFFA6]">1</strong> available</span>
            <span class="hidden sm:inline">‚Ä¢</span>
            <span><strong class="text-[#FF6B6B]">1</strong> borrowed</span>
        </div>
    </div>
    <div class="overflow-x-auto -mx-4 md:mx-0">
        <table class="min-w-full text-sm text-left">
            <thead class="text-gray-400 uppercase text-xs tracking-wider">
                <tr class="border-b border-gray-600/40">
                    <th class="py-3 px-4 font-medium">ID</th>
                    <th class="py-3 px-4 font-medium">Title</th>
                    <th class="py-3 px-4 font-medium">Authors</th>
                    <th class="py-3 px-4 font-medium">Categories</th>
                    <th class="py-3 px-4 font-medium">ISBN</th>
                    <th class="py-3 px-4 font-medium">Total Copies</th>
                    <th class="py-3 px-4 font-medium">Status</th>
                    <th class="py-3 px-4 font-medium text-right">Actions</th>
                </tr>
            </thead>
            <tbody class="text-gray-200">
                <tr class="table-row border-b border-gray-700/40 last:border-none">
                    <td class="px-4 py-3 align-top">1</td>
                    <td class="px-4 py-3 font-semibold align-top">ORCHID THE REST</td>
                    <td class="px-4 py-3 align-top space-y-1">
                        <div>Susan chery</div>
                        <div>Thanaphat Mallikeaw</div>
                    </td>
                    <td class="px-4 py-3 align-top space-y-1">
                        <span class="status-badge status-available">Fantasy</span>
                        <span class="status-badge status-available">Romance</span>
                    </td>
                    <td class="px-4 py-3 align-top">641249213181</td>
                    <td class="px-4 py-3 align-top">3</td>
                    <td class="px-4 py-3 align-top"><span class="status-badge status-available">Available</span></td>
                    <td class="px-4 py-3 align-top text-right whitespace-nowrap">
                        <button class="action-btn text-yellow-400 hover:text-yellow-300 mr-3" title="Edit">‚úèÔ∏è</button>
                        <button class="action-btn text-red-500 hover:text-red-400" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>
                <tr class="table-row border-b border-gray-700/40 last:border-none">
                    <td class="px-4 py-3 align-top">2</td>
                    <td class="px-4 py-3 font-semibold align-top">ORCHID THE REST</td>
                    <td class="px-4 py-3 align-top space-y-1">
                        <div>Susan chery</div>
                        <div>Thanaphat Mallikeaw</div>
                    </td>
                    <td class="px-4 py-3 align-top space-y-1">
                        <span class="status-badge status-available">Fantasy</span>
                        <span class="status-badge status-available">Romance</span>
                    </td>
                    <td class="px-4 py-3 align-top">555524242424</td>
                    <td class="px-4 py-3 align-top">5</td>
                    <td class="px-4 py-3 align-top"><span class="status-badge status-borrowed">All Borrowed</span></td>
                    <td class="px-4 py-3 align-top text-right whitespace-nowrap">
                        <button class="action-btn text-yellow-400 hover:text-yellow-300 mr-3" title="Edit">‚úèÔ∏è</button>
                        <button class="action-btn text-red-500 hover:text-red-400" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Book Modal -->
<div id="addBookModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-end sm:items-center justify-center">
    <div class="bg-[#2D2D2D] rounded-t-[39px] sm:rounded-2xl w-full max-w-md sm:max-w-2xl max-h-[90vh] overflow-y-auto relative">
        <!-- Mobile Header -->
        <div class="flex items-center justify-between p-6 sm:border-b sm:border-gray-600/40">
            <h2 class="text-xl sm:text-2xl font-semibold text-white">Add New Book</h2>
            <button id="closeModal" class="text-gray-400 hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center">&times;</button>
        </div>
        
        <!-- Modal Body -->
        <div class="px-6 pb-6 sm:p-6">
            <form id="addBookForm" method="post" action="#" class="space-y-4 sm:space-y-6">
                {% csrf_token %}
                
                <!-- Book Title -->
                <div>
                    <label class="block text-sm font-medium text-white/75 mb-2">Book Title *</label>
                    <input type="text" id="bookTitle" name="title" required 
                           class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all">
                </div>
                
                <!-- Authors -->
                <div>
                    <label class="block text-sm font-medium text-white/75 mb-2">Authors *</label>
                    <textarea id="bookAuthors" name="authors" required rows="2" 
                              placeholder="Enter authors separated by commas"
                              class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 resize-none transition-all"></textarea>
                </div>
                
                <!-- Categories -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-white/75">Categories</label>
                        <button type="button" id="createCategoryBtn" class="text-[#2C7852] hover:text-[#4CFFA6] text-sm font-medium flex items-center gap-1 transition-colors">
                            <span class="text-xs">Ôºã</span> Create Categories
                        </button>
                    </div>
                    <input type="text" id="bookCategories" name="categories" 
                           placeholder="Enter categories separated by commas"
                           class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all">
                </div>
                
                <!-- ISBN and Copies Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-white/75 mb-2">ISBN *</label>
                        <input type="text" id="bookIsbn" name="isbn" required 
                               class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white/75 mb-2">Total Copies *</label>
                        <input type="number" id="bookCopies" name="copies" required min="1" value="1"
                               class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all">
                    </div>
                </div>
                
                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-white/75 mb-2">Description</label>
                    <textarea id="bookDescription" name="description" rows="3" 
                              placeholder="Enter book description..."
                              class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 resize-none transition-all"></textarea>
                </div>
                
                <!-- Publication Year and Image Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-white/75 mb-2">Publication Year</label>
                        <input type="number" id="bookYear" name="year" min="1000" max="2100"
                               class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white/75 mb-2">Book Image</label>
                        <input type="file" id="bookImage" name="image" accept="image/*"
                               class="w-full bg-[#424242] border border-gray-600/40 rounded-[15px] px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#2C7852] focus:ring-2 focus:ring-[#2C7852]/20 transition-all file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#2C7852] file:text-white hover:file:bg-[#246b47]">
                    </div>
                </div>
            </form>
        </div>
        
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 p-6 border-t border-gray-600/40">
            <button id="cancelBtn" type="button" class="px-6 py-3 text-gray-300 hover:text-white transition-colors rounded-[15px] border border-gray-600/40 font-medium">
                Cancel
            </button>
            <button type="submit" form="addBookForm"
                    class="bg-[#2C7852] hover:bg-[#246b47] px-8 py-3 text-white font-medium rounded-[15px] transition-all transform hover:scale-105 shadow-lg">
                Save Book
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addBookBtn = document.getElementById('addBookBtn');
        const modal = document.getElementById('addBookModal');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const addBookForm = document.getElementById('addBookForm');
        
        // Show modal
        addBookBtn.addEventListener('click', function() {
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        });
        
        // Hide modal function
        function hideModal() {
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restore scrolling
            addBookForm.reset(); // Clear form
        }
        
        // Close modal events
        closeModal.addEventListener('click', hideModal);
        cancelBtn.addEventListener('click', hideModal);
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                hideModal();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                hideModal();
            }
        });
    });
</script>
{% endblock %}